if [ -x /opt/homebrew/bin/brew ]; then
  eval "$(/opt/homebrew/bin/brew shellenv)"
elif [ -x /usr/local/bin/brew ]; then
  eval "$(/usr/local/bin/brew shellenv)"
elif [ -x /home/linuxbrew/.linuxbrew/bin/brew ]; then
  eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
else
  echo "[chezmoi] Homebrew not found. Please install Homebrew first."; exit 1
fi

# Basic PATH
export PATH="$HOME/.local/bin:$PATH"

# ----- mise (tool/version manager) -----
if command -v mise >/dev/null 2>&1; then
  eval "$(mise activate zsh)"
fi

# =========================
# Completion (must precede fzf-tab)
# =========================
autoload -Uz compinit
# Use a cached compdump for speed; build if missing
ZCOMPDUMP_PATH="${ZDOTDIR:-$HOME}/.zcompdump"
if [[ -r "$ZCOMPDUMP_PATH" ]]; then
  compinit -d "$ZCOMPDUMP_PATH"
else
  compinit -C -d "$ZCOMPDUMP_PATH"
fi

# =========================
# Plugins via zgenom
# =========================
# Install/Update zgenom with a chezmoi run_once_* script (see guide).
# Load zgenom and compile plugin init on first run for fast startups.
if [ -r "$HOME/.zgenom/zgenom.zsh" ]; then
  source "$HOME/.zgenom/zgenom.zsh"

  if ! zgenom saved; then
    echo "[zgenom] Building plugin cache..."

    # External plugins you used before
    zgenom load Aloxaf/fzf-tab
    zgenom load wfxr/forgit
    zgenom load jeffreytse/zsh-vi-mode
    zgenom load zsh-users/zsh-autosuggestions
    zgenom load zsh-users/zsh-syntax-highlighting

    zgenom save
  fi
else
  echo "[zshrc] zgenom not found. Run 'chezmoi apply' to install it." >&2
fi

if command -v zoxide >/dev/null 2>&1; then
  eval "$(zoxide init zsh)"
fi

if command -v starship >/dev/null 2>&1; then
  eval "$(starship init zsh)"
fi

if command -v nvim >/dev/null 2>&1; then
  alias vim='nvim'
  alias vi='nvim'
fi

if command -v lazygit >/dev/null 2>&1; then
  alias lg='lazygit'
fi

if command -v eza >/dev/null 2>&1; then
  alias l='eza'
  alias la='eza -a'
  alias ll='eza -lah'
  alias ls='eza --color=auto'
else
  alias ll='ls -lah'
fi

if command -v bat >/dev/null 2>&1; then
  alias cat='bat -P --style=plain'
fi

setopt autocd extendedglob interactivecomments
setopt histignorealldups sharehistory incappendhistory
HISTFILE="$HOME/.zsh_history"
HISTSIZE=200000
SAVEHIST=200000
